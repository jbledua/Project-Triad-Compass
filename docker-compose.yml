---
services:
  # ----------------------------
  # PROWLARR (Indexer manager)
  # ----------------------------
  prowlarr-ts:
    image: tailscale/tailscale:latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-prowlarr-ts
    hostname: ${TS_HOSTNAME_PROWLARR}
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_USERSPACE=false
      - "TS_EXTRA_ARGS=--advertise-tags=tag:container --reset"
    volumes:
      - prowlarr-ts-state:/var/lib/tailscale
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - net_admin
    restart: unless-stopped
    ports:
      - "${PUBLIC_PORT_PROWLARR:-9696}:9696"

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:amd64-latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-prowlarr
    network_mode: service:prowlarr-ts
    depends_on:
      - prowlarr-ts
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TIMEZONE:-America/Toronto}
    volumes:
      - prowlarr-config:/config
    restart: unless-stopped

  # ----------------------------
  # RADARR (Movies)
  # ----------------------------
  radarr-ts:
    image: tailscale/tailscale:latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-radarr-ts
    hostname: ${TS_HOSTNAME_RADARR}
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_USERSPACE=false
      - "TS_EXTRA_ARGS=--advertise-tags=tag:container --reset"
    volumes:
      - radarr-ts-state:/var/lib/tailscale
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - net_admin
    restart: unless-stopped
    ports:
      - "${PUBLIC_PORT_RADARR:-7878}:7878"

  radarr:
    image: lscr.io/linuxserver/radarr:amd64-latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-radarr
    network_mode: service:radarr-ts
    depends_on:
      - radarr-ts
      - prowlarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TIMEZONE:-America/Toronto}
    volumes:
      - radarr-config:/config
      - "${DOWNLOADS_DIR}:/downloads"
      - "${MOVIES_DIR}:/movies"
    restart: unless-stopped

  # ----------------------------
  # SONARR (TV Shows)
  # ----------------------------
  sonarr-ts:
    image: tailscale/tailscale:latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-sonarr-ts
    hostname: ${TS_HOSTNAME_SONARR}
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_USERSPACE=false
      - "TS_EXTRA_ARGS=--advertise-tags=tag:container --reset"
    volumes:
      - sonarr-ts-state:/var/lib/tailscale
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - net_admin
    restart: unless-stopped
    ports:
      - "${PUBLIC_PORT_SONARR:-8989}:8989"

  sonarr:
    image: lscr.io/linuxserver/sonarr:amd64-latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-sonarr
    network_mode: service:sonarr-ts
    depends_on:
      - sonarr-ts
      - prowlarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TIMEZONE:-America/Toronto}
    volumes:
      - sonarr-config:/config
      - "${DOWNLOADS_DIR}:/downloads"
      - "${TV_DIR}:/tv"
    restart: unless-stopped

  # ----------------------------
  # READARR (Books / Audiobooks metadata)
  # ----------------------------
  # readarr-ts:
  #   image: tailscale/tailscale:latest
  #   container_name: ${STACK_NAME}-readarr-ts
  #   hostname: ${TS_HOSTNAME_READARR}
  #   environment:
  #     - TS_AUTHKEY=${TS_AUTHKEY}
  #     - TS_STATE_DIR=/var/lib/tailscale
  #     - TS_USERSPACE=false
  #     - "TS_EXTRA_ARGS=--advertise-tags=tag:container --reset"
  #   volumes:
  #     - readarr-ts-state:/var/lib/tailscale
  #   devices: 
  #     - /dev/net/tun:/dev/net/tun
  #   cap_add:
  #     - net_admin
  #   restart: unless-stopped
  #   ports:
  #     - "${PUBLIC_PORT_READARR:-8787}:8787"

  # readarr:
  #   image: lscr.io/linuxserver/readarr:develop
  #   container_name: ${STACK_NAME}-readarr
  #   network_mode: service:readarr-ts
  #   depends_on:
  #     - readarr-ts
  #     - prowlarr
  #   environment:
  #     - PUID=${PUID:-1000}
  #     - PGID=${PGID:-1000}
  #     - TZ=${TIMEZONE:-America/Toronto}
  #   volumes:
  #     - readarr-config:/config
  #     - "${DOWNLOADS_DIR}:/downloads"
  #     - "${BOOKS_DIR}:/books"
  #     - "${AUDIOBOOKS_DIR}:/audiobooks"
  #   restart: unless-stopped

  # ----------------------------
  # LIDARR (Music)
  # ----------------------------
  lidarr-ts:
    image: tailscale/tailscale:latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-lidarr-ts
    hostname: ${TS_HOSTNAME_LIDARR}
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_USERSPACE=false
      - "TS_EXTRA_ARGS=--advertise-tags=tag:container --reset"
    volumes:
      - lidarr-ts-state:/var/lib/tailscale
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - net_admin
    restart: unless-stopped
    ports:
      - "${PUBLIC_PORT_LIDARR:-8686}:8686"

  lidarr:
    image: lscr.io/linuxserver/lidarr:amd64-latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-lidarr
    network_mode: service:lidarr-ts
    depends_on:
      - lidarr-ts
      - prowlarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TIMEZONE:-America/Toronto}
    volumes:
      - lidarr-config:/config
      - "${DOWNLOADS_DIR}:/downloads"
      - "${MUSIC_DIR}:/music"
    restart: unless-stopped

  # ----------------------------
  # BAZARR (Subtitles)
  # ----------------------------
  bazarr-ts:
    image: tailscale/tailscale:latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-bazarr-ts
    hostname: ${TS_HOSTNAME_BAZARR}
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_USERSPACE=false
      - "TS_EXTRA_ARGS=--advertise-tags=tag:container --reset"
    volumes:
      - bazarr-ts-state:/var/lib/tailscale
    devices:
      - /dev/net/tun:/dev/net/tun
    cap_add:
      - net_admin
    restart: unless-stopped
    ports:
      - "${PUBLIC_PORT_BAZARR:-6767}:6767"

  bazarr:
    image: lscr.io/linuxserver/bazarr:amd64-latest
    platform: ${DOCKER_PLATFORM}
    container_name: ${STACK_NAME}-bazarr
    network_mode: service:bazarr-ts
    depends_on:
      - bazarr-ts
      - radarr
      - sonarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TIMEZONE:-America/Toronto}
    volumes:
      - bazarr-config:/config
      - "${MOVIES_DIR}:/movies"
      - "${TV_DIR}:/tv"
    restart: unless-stopped

  # ----------------------------
  # PODGRAB (Podcasts) - disabled
  # ----------------------------
  # podgrab-ts:
  #   image: tailscale/tailscale:latest
  #   container_name: ${STACK_NAME}-podgrab-ts
  #   hostname: ${TS_HOSTNAME_PODGRAB}
  #   environment:
  #     - TS_AUTHKEY=${TS_AUTHKEY}
  #     - TS_STATE_DIR=/var/lib/tailscale
  #     - TS_USERSPACE=false
  #     - "TS_EXTRA_ARGS=--advertise-tags=tag:container --reset"
  #   volumes:
  #     - podgrab-ts-state:/var/lib/tailscale
  #   devices:
  #     - /dev/net/tun:/dev/net/tun
  #   cap_add:
  #     - net_admin
  #   restart: unless-stopped
  #   ports:
  #     - "${PUBLIC_PORT_PODGRAB:-8081}:8080"
  #
  # podgrab:
  #   image: lscr.io/linuxserver/podgrab:latest
  #   container_name: ${STACK_NAME}-podgrab
  #   network_mode: service:podgrab-ts
  #   depends_on:
  #     - podgrab-ts
  #   environment:
  #     - PUID=${PUID:-1000}
  #     - PGID=${PGID:-1000}
  #     - TZ=${TIMEZONE:-America/Toronto}
  #   volumes:
  #     - podgrab-config:/config
  #     - "${PODCASTS_DIR}:/podcasts"
  #   restart: unless-stopped

  # ----------------------------
  # OPTIONAL: JACKett (if you choose it instead of Prowlarr)
  # Leave disabled by default; enable by uncommenting and wiring in UI.
  # ----------------------------
  # jackett-ts:
  #   image: tailscale/tailscale:latest
  #   container_name: ${STACK_NAME}-jackett-ts
  #   hostname: ${TS_HOSTNAME_JACKETT}
  #   environment:
  #     - TS_AUTHKEY=${TS_AUTHKEY}
  #     - TS_STATE_DIR=/var/lib/tailscale
  #     - TS_USERSPACE=false
  #     - "TS_EXTRA_ARGS=--advertise-tags=tag:container --reset"
  #   volumes:
  #     - jackett-ts-state:/var/lib/tailscale
  #   devices:
  #     - /dev/net/tun:/dev/net/tun
  #   cap_add:
  #     - net_admin
  #   restart: unless-stopped
  #   ports:
  #     - "${PUBLIC_PORT_JACKETT:-9117}:9117"
  #
  # jackett:
  #   image: lscr.io/linuxserver/jackett:latest
  #   container_name: ${STACK_NAME}-jackett
  #   network_mode: service:jackett-ts
  #   depends_on:
  #     - jackett-ts
  #   environment:
  #     - PUID=${PUID:-1000}
  #     - PGID=${PGID:-1000}
  #     - TZ=${TIMEZONE:-America/Toronto}
  #   volumes:
  #     - jackett-config:/config
  #   restart: unless-stopped

volumes:
  prowlarr-ts-state:
    name: ${STACK_NAME}-prowlarr-ts-state
  prowlarr-config:
      name: ${STACK_NAME}-prowlarr-config

  radarr-ts-state:
    name: ${STACK_NAME}-radarr-ts-state
  radarr-config:
    name: ${STACK_NAME}-radarr-config

  sonarr-ts-state:
    name: ${STACK_NAME}-sonarr-ts-state
  sonarr-config:
      name: ${STACK_NAME}-sonarr-config

  # readarr-ts-state:
  #   name: ${STACK_NAME}-readarr-ts-state
  # readarr-config:
  #   name: ${STACK_NAME}-readarr-config

  lidarr-ts-state:
    name: ${STACK_NAME}-lidarr-ts-state
  lidarr-config:
    name: ${STACK_NAME}-lidarr-config

  bazarr-ts-state:
    name: ${STACK_NAME}-bazarr-ts-state
  bazarr-config:
    name: ${STACK_NAME}-bazarr-config

  podgrab-ts-state:
    name: ${STACK_NAME}-podgrab-ts-state
  podgrab-config:
    name: ${STACK_NAME}-podgrab-config

  # jackett-ts-state:
  #   name: ${STACK_NAME}-jackett-ts-state
  # jackett-config:
  #   name: ${STACK_NAME}-jackett-config
